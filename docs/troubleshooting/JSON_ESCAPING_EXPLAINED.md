# 🔧 Объяснение экранирования JSON

## Проблема

При вставке JSON в Swagger UI вручную возникают ошибки:
```
422 Error: Invalid control character at
```

Это происходит из-за неэкранированных специальных символов в тексте документации.

## ✅ Решение: Автоматическое экранирование

Python's `json.dumps()` и библиотека `requests` **автоматически правильно экранируют** все символы:

### Что экранируется:

1. **Двойные кавычки**: `"` → `\"`
   ```json
   "text": "Слово \"NULL\" в кавычках"
   ```

2. **Переносы строк**: `\n` → `\\n`
   ```json
   "text": "Строка 1\\nСтрока 2"
   ```

3. **Обратные слеши**: `\` → `\\`
   ```json
   "text": "Путь: C:\\\\Windows"
   ```

4. **Управляющие символы**: все специальные символы автоматически экранируются

## 📋 Как это работает

### Использование Python с requests

```python
import requests

# Читаем файл
with open("document.md", "r", encoding="utf-8") as f:
    document = f.read()

# Отправляем запрос
response = requests.post(
    "http://localhost:8000/api/v1/review/start",
    json={  # requests автоматически правильно экранирует!
        "document": document,
        "document_type": "markdown",
        "context": {}
    }
)
```

**Это самый надежный способ!** `requests` библиотека автоматически:
- Правильно экранирует все символы
- Устанавливает правильный Content-Type
- Отправляет валидный JSON

### Использование Swagger UI

Swagger UI также автоматически правильно экранирует символы при заполнении полей формы.

## 🎯 Рекомендации

### ✅ Рекомендуется: Использовать Swagger UI или Python

**Swagger UI:**
1. Откройте http://localhost:8000/docs
2. Заполните поля формы
3. Swagger UI автоматически создаст правильный JSON

**Python:**
```python
import requests

with open("file.md", "r", encoding="utf-8") as f:
    document = f.read()

response = requests.post(
    "http://localhost:8000/api/v1/review/start",
    json={"document": document, "document_type": "markdown", "context": {}}
)
```

## 📝 Пример правильного экранирования

**Исходный текст:**
```
Текст с "кавычками" и
переносом строки
```

**В JSON (правильно экранировано):**
```json
{
  "document": "Текст с \"кавычками\" и\nпереносом строки"
}
```

**Что произошло:**
- `"` → `\"` (кавычки экранированы)
- `\n` → `\\n` (перенос строки экранирован)

## ✅ Вывод

**Используйте Swagger UI или Python с requests** - они автоматически правильно экранируют все символы!

- Swagger UI - для интерактивного использования
- Python с requests - для автоматизации и скриптов

Все эти методы используют правильное экранирование JSON.
