# 🔧 Объяснение экранирования JSON

## Проблема

При вставке JSON в Swagger UI вручную возникают ошибки:
```
422 Error: Invalid control character at
```

Это происходит из-за неэкранированных специальных символов в тексте документации.

## ✅ Решение: Автоматическое экранирование

Python's `json.dumps()` **автоматически правильно экранирует** все символы:

### Что экранируется:

1. **Двойные кавычки**: `"` → `\"`
   ```json
   "text": "Слово \"NULL\" в кавычках"
   ```

2. **Переносы строк**: `\n` → `\\n`
   ```json
   "text": "Строка 1\\nСтрока 2"
   ```

3. **Обратные слеши**: `\` → `\\`
   ```json
   "text": "Путь: C:\\\\Windows"
   ```

4. **Управляющие символы**: все специальные символы автоматически экранируются

## 📋 Как это работает в скриптах

### Скрипт `show_file_content_json.py`

```python
# 1. Читаем файл
document = file.read_text()

# 2. Создаем объект
request_body = {
    "document": document,  # Текст с кавычками, переносами строк и т.д.
    "document_type": "markdown",
    "context": {}
}

# 3. Конвертируем в JSON (автоматическое экранирование)
json_string = json.dumps(request_body, ensure_ascii=False, indent=2)
# json.dumps() автоматически экранирует ВСЕ специальные символы!
```

### Скрипт `send_review_request.py`

```python
# Использует requests.post с параметром json=
response = requests.post(
    url,
    json=request_data  # requests автоматически правильно экранирует!
)
```

**Это самый надежный способ!** `requests` библиотека автоматически:
- Правильно экранирует все символы
- Устанавливает правильный Content-Type
- Отправляет валидный JSON

## 🎯 Рекомендации

### ✅ Рекомендуется: Использовать скрипты

```bash
# Самый простой способ - без ошибок
python scripts/cli/send_review_request.py
```

### ⚠️ Если нужно использовать Swagger UI

1. Используйте `show_file_content_json.py` для получения JSON
2. Копируйте весь JSON целиком
3. В Swagger UI выберите формат `application/json`
4. Вставьте JSON

**Если все равно ошибка** - используйте скрипт `send_review_request.py`

## 🔍 Проверка экранирования

Проверка экранирования встроена в `show_file_content_json.py`:
```bash
python scripts/cli/show_file_content_json.py
```

Скрипт покажет:
- ✅ JSON валиден
- ✅ Какие символы экранированы
- ✅ Готовый JSON для копирования

## 📝 Пример правильного экранирования

**Исходный текст:**
```
Текст с "кавычками" и
переносом строки
```

**В JSON (правильно экранировано):**
```json
{
  "document": "Текст с \"кавычками\" и\nпереносом строки"
}
```

**Что произошло:**
- `"` → `\"` (кавычки экранированы)
- `\n` → `\\n` (перенос строки экранирован)

## ✅ Вывод

**Используйте скрипты** - они автоматически правильно экранируют все символы!

- `send_review_request.py` - для отправки запроса
- `show_file_content_json.py` - для получения JSON для Swagger UI
- `show_file_content_json.py` - для проверки экранирования и получения JSON

Все скрипты используют `json.dumps()`, который гарантирует правильное экранирование.

