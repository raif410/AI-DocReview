# 🔧 Исправление ошибки JSON в Swagger UI

## ❌ Ошибка, которую вы получили

```
422 Error: Unprocessable Entity
"JSON decode error"
"Invalid control character at"
```

## 🔍 Причина ошибки

Ошибка возникает, когда в тексте документации есть специальные символы (переносы строк, табуляции и т.д.), которые не правильно экранированы для JSON.

## ✅ Решение: Используйте правильный JSON формат

### Способ 1: Используйте скрипт с JSON форматом (РЕКОМЕНДУЕТСЯ)

1. **Запустите новый скрипт:**
   ```bash
   python scripts/cli/show_file_content_json.py
   ```

2. **Скрипт выведет правильный JSON:**
   ```json
   {
     "document": "# my_docs.md\n\n---\n\n### **Документация...",
     "document_type": "markdown",
     "context": {}
   }
   ```

3. **Скопируйте весь JSON** (от `{` до `}`)

4. **В Swagger UI:**
   - Найдите `POST /api/v1/review/start`
   - Нажмите "Try it out"
   - **ВАЖНО:** В поле "Request body" выберите формат `application/json`
   - Вставьте скопированный JSON
   - Нажмите "Execute"

### Способ 2: Исправление вручную

Если используете старый способ, убедитесь что:

1. **В Swagger UI выбран правильный формат:**
   - В поле "Request body" должно быть: `application/json`
   - НЕ `text/plain` или другой формат

2. **Текст правильно экранирован:**
   - Переносы строк должны быть как `\n`
   - Кавычки должны быть экранированы `\"`
   - Специальные символы должны быть экранированы

3. **Используйте формат JSON:**
   ```json
   {
     "document": "ваш текст здесь",
     "document_type": "markdown",
     "context": {}
   }
   ```

---

## 📋 Пошаговая инструкция (правильный способ)

### Шаг 1: Запустите скрипт

```bash
python scripts/cli/show_file_content_json.py
```

### Шаг 2: Скопируйте JSON

Вы увидите что-то вроде:
```json
{
  "document": "# my_docs.md\n\n---\n\n### **Документация (Версия 1.0)**\n\n...",
  "document_type": "markdown",
  "context": {}
}
```

**Скопируйте весь JSON** (от первой `{` до последней `}`)

### Шаг 3: В Swagger UI

1. Откройте http://localhost:8000/docs
2. Найдите `POST /api/v1/review/start`
3. Нажмите **"Try it out"**
4. **ВАЖНО:** В поле "Request body" (вверху) выберите `application/json`
5. Вставьте скопированный JSON в большое текстовое поле
6. Нажмите **"Execute"**

---

## ⚠️ Частые ошибки

### Ошибка 1: Неправильный формат Request body

**Проблема:** Выбрано `text/plain` вместо `application/json`

**Решение:** В поле "Request body" выберите `application/json`

### Ошибка 2: Неполный JSON

**Проблема:** Скопирован только текст документа, а не весь JSON объект

**Решение:** Копируйте весь JSON от `{` до `}`, включая все поля

### Ошибка 3: Неправильное экранирование

**Проблема:** Специальные символы не экранированы

**Решение:** Используйте `show_file_content_json.py` - он правильно экранирует все символы

---

## 🎯 Быстрое решение

```bash
# 1. Запустите скрипт с JSON форматом
python scripts/cli/show_file_content_json.py

# 2. Скопируйте весь JSON (от { до })

# 3. В Swagger UI:
#    - Request body: application/json
#    - Вставьте JSON
#    - Execute
```

**Готово!** ✅

